<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LG U+ ì‹¬ë¦¬ì¼€ì–´ ì„œë¹„ìŠ¤ - ë…¹ìŒì¤‘</title>
    <link rel="icon" href="../assets/images/favicon.ico" type="image/x-icon"/>
    <!-- css -->
    <link rel="stylesheet" href="../assets/css/reset.css">
    <link rel="stylesheet" href="../assets/css/font.css">
    <link rel="stylesheet" href="../assets/css/pages/recordings.css">
    <!-- js -->
    <script src="../assets/js/jquery-3.7.1.min.js"></script>
    <script src="../assets/js/common.js"></script>

    <!-- ì˜¤ë””ì˜¤ íŒŒí˜• ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
    <script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/record.min.js"></script>
</head>
<body>
    <div class="wrapper recordings">
        <header>
            <div class="inner">
                <button class="back-btn" type="button" aria-label="ë’¤ë¡œê°€ê¸°"></button>
                <strong class="page-tit">ë…¹ìŒì¤‘</strong>
                <button class="help-btn" type="button">HELP</button>
            </div>
        </header>
        <main>
            <div class="inner">
                <div class="con-wrap">
                    <div class="info-wrap">
                        <strong class="recording-tit">ìƒë‹´ ë…¹ìŒ íŒŒì¼ëª…</strong>
                        <p class="datetime-wrap">
                            <span class="date">2025.04.25(ê¸ˆ)</span> <span class="time">ì˜¤ì „ 10:11</span>
                        </p>
                    </div>
                    <div class="waveform-wrap">
                        <div id="waveform"></div>
                    </div>
                    <div class="recording-time">
                        <strong>00:00.00</strong>
                    </div>
                    <div class="control-wrap">
                        <button class="record-btn on" type="button" aria-label="ë…¹ìŒ"></button>
                        <button class="pause-btn" type="button" aria-label="ì •ì§€"></button>
                    </div>
                </div>
                <div class="complete-wrap">
                    <button class="complete-btn" type="button">ì™„ë£Œ</button>
                </div>
                <!-- ë…¹ìŒ íŒŒì¼ëª… ì…ë ¥ on class ì¶”ê°€ -->
                <div class="bottom-sheet file-name">
                    <div class="inner">
                        <div class="hd-wrap">
                            <strong>ë…¹ìŒ íŒŒì¼ëª… ì…ë ¥</strong>
                            <button class="close-btn" type="button" aria-label="ë‹«ê¸°"></button>
                        </div>
                        <div class="input-wrap">
                            <input id="fileName" type="text" placeholder="ë…¹ìŒ íŒŒì¼ëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.">
                            <label class="hide" for="fileName"></label>
                        </div>
                        <div class="btn-wrap">
                            <button class="save-btn" type="button">ì €ì¥í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script>
        let isRecording = false;
        let recordPlugin;
        let micWaveSurfer;
        let timerInterval = null;
        let startTime = 0;
        let totalRecordedTime = 0; // ëˆ„ì  ë…¹ìŒ ì‹œê°„
        let chunks = [];

        const micContainer = document.getElementById("waveform");
        const recordBtn = document.querySelector(".record-btn");
        const stopBtn = document.querySelector(".pause-btn");
        const timeDisplay = document.querySelector(".recording-time strong");

        // ë§ˆì´í¬ íŒŒí˜•ìš© wavesurfer ì¸ìŠ¤í„´ìŠ¤
        micWaveSurfer = WaveSurfer.create({
            container: micContainer,
            height: 300,
            waveColor: "#A7B5BC",
            progressColor: '#A7B5BC',
            cursorColor: '#32D074',
            cursorWidth: 1,
            barWidth: 3,
            barMinHeight: 3,
            barGap: 2,
            barRadius: 2,
            scrollParent: true,
            minPxPerSec: 50,
            dragToSeek: true,
            hideScrollbar: true,
            autoplay: false,
            autoScroll: true,
            // autoCenter: true, ë…¹ìŒ ì¤‘ì—” ì‘ë™ì•ˆí•¨
            sampleRate: 44100,
        });

        // record í”ŒëŸ¬ê·¸ì¸ ë“±ë¡
        recordPlugin = micWaveSurfer.registerPlugin(
            WaveSurfer.Record.create()
        );

        // ë…¹ìŒ ì¢…ë£Œ ì‹œ blob ìˆ˜ì§‘
        recordPlugin.on("record-end", (blob) => {
            chunks.push(blob); // ì´ì–´ë¶™ì´ê¸° ìœ„í•´ ì €ì¥
            console.log("ë…¹ìŒ chunk ì €ì¥ë¨", blob);
        });

        // ì´ˆê¸° ìƒíƒœ: Stop, Save ë²„íŠ¼ ìˆ¨ê¹€
        stopBtn.classList.remove("on");
        // if (saveBtn) saveBtn.classList.remove("on");

        // ì‹œê°„ í¬ë§·
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            const hundredths = Math.floor((ms % 1000) / 10);
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(hundredths).padStart(2, '0')}`;
        }

        // Record ë²„íŠ¼ í´ë¦­ ì‹œ
        recordBtn.onclick = () => {
            recordPlugin.startRecording().then(() => {
                console.log("ğŸ”´ ë…¹ìŒ ì‹œì‘");

                isRecording = true;
                recordBtn.classList.remove("on");
                stopBtn.classList.add("on");

                // ì´ì–´ì„œ ì‹œê°„ ê³„ì‚°
                startTime = Date.now() - totalRecordedTime;

                // íƒ€ì´ë¨¸ ì‹œì‘
                timerInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    timeDisplay.textContent = formatTime(elapsed);
                }, 30);
            });
        };

        // Stop ë²„íŠ¼ í´ë¦­ ì‹œ
        stopBtn.onclick = () => {
            recordPlugin.stopRecording();
            isRecording = false;
            console.log("â¹ï¸ ë…¹ìŒ ì •ì§€");

            stopBtn.classList.remove("on");
            recordBtn.classList.add("on");

            // ëˆ„ì  ì‹œê°„ ì €ì¥
            totalRecordedTime = Date.now() - startTime;

            // íƒ€ì´ë¨¸ ì •ì§€ (ì‹œê°„ì€ ìœ ì§€)
            clearInterval(timerInterval);
        };
    </script>
</body>
</html>